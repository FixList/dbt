machine:
  python:
    version: 3.6.0
  post:
    - pyenv global 2.7.12 3.6.0
  hosts:
    database: 127.0.0.1

database:
  override:
    - bash test/setup_db.sh

dependencies:
  pre:
    - pip install --upgrade pip setuptools || true
    - pip install --upgrade tox tox-pyenv
    - curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -
    - curl https://packages.microsoft.com/config/ubuntu/14.04/prod.list > /etc/apt/sources.list.d/mssql-release.list
    - ACCEPT_EULA=Y apt-get install -y unixodbc odbcinst unixodbc-dev locales msodbcsql
  override:
    - pyenv local 2.7.12 3.6.0

test:
  override:
    - sudo chown -R ubuntu:ubuntu /root/
    - /bin/bash -c 'cd /home/ubuntu/dbt && tox'
  post:
    - mv htmlcov $CIRCLE_ARTIFACTS/
